<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Royal Crush — Two-Hero Tracker (Simple)</title>
<style>
  :root{
    --bg:#0f1115; --panel:#171a21; --ink:#e9eef6; --sub:#aab3c2;
    --line:#272c3b; --chip:#141a24; --chipline:#293143;
    --accent:#60a5fa; --good:#34d399; --warn:#f59e0b; --bad:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
       font:15px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:900px;margin:0 auto;padding:16px}
  h1{margin:0 0 12px;font-size:20px}
  .card{background:#171a21;border:1px solid var(--line);border-radius:14px;padding:14px}
  .grid{display:grid;gap:10px}
  .g2{grid-template-columns:1fr 1fr}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .bar{height:12px;background:#0e1420;border:1px solid #283045;border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--good))}
  .sub{color:var(--sub);font-size:12px}
  .btn{padding:9px 12px;border-radius:12px;border:1px solid var(--line);background:#151924;color:#e9eef6;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn.red{background:#2a1215;border-color:#3a1a1e}
  input,select{width:100%;padding:9px;border-radius:10px;border:1px solid var(--line);background:#0f131b;color:#e9eef6}
  .chip{background:var(--chip);border:1px solid var(--chipline);border-radius:999px;padding:4px 8px;font-size:12px;color:#cfe3ff}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace}
  .section{display:flex;justify-content:space-between;align-items:flex-end}
  .muted{opacity:.8}
  .footer{margin-top:12px;display:flex;gap:10px;align-items:center}
  .hide{display:none}
</style>
</head>
<body>
<div class="wrap">
  <h1>Royal Crush — Two-Hero Tracker</h1>

  <!-- Boss Panel -->
  <div class="card" style="margin-bottom:10px">
    <div class="section">
      <div>
        <div class="sub">Royal</div>
        <div style="font-size:20px;font-weight:700" id="bossName">—</div>
        <div class="sub" id="bossStats">HP — • DMG —</div>
      </div>
      <div style="text-align:right">
        <div class="sub">Boss HP</div>
        <div style="font-size:22px;font-weight:700">
          <span id="hpNow">0</span>/<span id="hpMax">0</span>
        </div>
      </div>
    </div>
    <div class="bar" style="margin:8px 0 10px"><span id="hpBar" style="width:0%"></span></div>

    <div class="grid" style="grid-template-columns:2fr 1fr">
      <div class="card" style="padding:10px">
        <div class="row">
          <button class="btn" id="abilityBtn">Boss Ability (d12)</button>
          <div class="chip mono" id="abilityOut">—</div>
        </div>
        <div class="row" style="margin-top:8px">
          <select id="bossTarget">
            <option value="AUTO" selected>Target: Auto (lowest HP)</option>
            <option value="A">Target: Hero A</option>
            <option value="B">Target: Hero B</option>
          </select>
          <button class="btn red" id="bossTurnBtn">Boss Turn → Next Round</button>
          <div class="chip mono" id="roundOut">R1</div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn" id="poiPlus">POI +1</button>
          <button class="btn" id="poiMinus">POI -1</button>
          <div class="chip">POI: <span id="poiVal">0</span></div>
        </div>
      </div>

      <div class="card" style="padding:10px">
        <div class="sub" style="margin-bottom:6px">Change Royal</div>
        <div class="row" id="bossButtons"></div>
      </div>
    </div>
    <div class="sub muted" style="margin-top:6px">J 8/2 (≤3 +2) • Q 14/4 (≤3 heal3) • K 18/5 (≤2 purge) • Joker 26/6 (8–10 ×2)</div>
  </div>

  <!-- Heroes -->
  <div class="grid g2">
    <!-- A -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="sub">Hero A</div>
        <select id="classA">
          <option>Knight</option>
          <option>Mage</option>
          <option>Assassin</option>
          <option>Priest</option>
        </select>
      </div>
      <div class="section" style="margin-top:6px">
        <div class="row">
          <div class="chip">HP: <span id="hpA">35</span></div>
          <button class="btn" id="hpAMinus">-1</button>
          <button class="btn" id="hpAPlus">+1</button>
        </div>
        <div class="row">
          <div class="chip hide" id="statusA"></div>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <select id="valA">
          <option>2</option><option>3</option><option>4</option>
          <option selected>5</option><option>6</option><option>7</option>
          <option>8</option><option>9</option>
        </select>
        <select id="suitA">
          <option value="club">♣</option>
          <option value="spade">♠</option>
          <option value="heart">♥</option>
          <option value="diamond" selected>♦</option>
        </select>
        <button class="btn" id="rollA">Roll d12</button>
      </div>
      <div class="row" style="margin-top:6px">
        <div class="chip mono" id="rollOutA">—</div>
        <div class="chip mono" id="resultA">—</div>
      </div>
    </div>

    <!-- B -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="sub">Hero B</div>
        <select id="classB">
          <option>Knight</option>
          <option selected>Mage</option>
          <option>Assassin</option>
          <option>Priest</option>
        </select>
      </div>
      <div class="section" style="margin-top:6px">
        <div class="row">
          <div class="chip">HP: <span id="hpB">30</span></div>
          <button class="btn" id="hpBMinus">-1</button>
          <button class="btn" id="hpBPlus">+1</button>
        </div>
        <div class="row">
          <div class="chip hide" id="statusB"></div>
        </div>
      </div>

      <div class="row" style="margin-top:8px">
        <select id="valB">
          <option>2</option><option>3</option><option>4</option>
          <option selected>5</option><option>6</option><option>7</option>
          <option>8</option><option>9</option>
        </select>
        <select id="suitB">
          <option value="club">♣</option>
          <option value="spade">♠</option>
          <option value="heart">♥</option>
          <option value="diamond" selected>♦</option>
        </select>
        <button class="btn" id="rollB">Roll d12</button>
      </div>
      <div class="row" style="margin-top:6px">
        <div class="chip mono" id="rollOutB">—</div>
        <div class="chip mono" id="resultB">—</div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <label class="row" style="gap:6px">
      <input type="checkbox" id="perfModeChk" />
      <span class="sub">Performance Mode</span>
    </label>
    <button class="btn" id="clearSaveBtn">Clear Save</button>
    <button class="btn" id="resetBoss">Reset Royal</button>
  </div>
</div>

<script>
/* -------- Basics -------- */
const bosses = [
  {id:'jack',  label:'J♣J♠J♥J♦', name:'Jacks',  maxHP:8,  atk:2},
  {id:'queen', label:'Q♣Q♠Q♥Q♦', name:'Queens', maxHP:14, atk:4},
  {id:'king',  label:'K♣K♠K♥K♦', name:'Kings',  maxHP:18, atk:5},
  {id:'joker', label:'Jokers',   name:'Jokers', maxHP:26, atk:6},
];
const DMG_PER_HIT = 5;             // nat-1 gives +1 (Mage +2)
const BASE_PLAYS_PER_HERO = 1;     // plays are tracked silently; only shown if ♦ creates extras
const BASE_DIAMOND_CAP = 2;        // Mage cap +1
const BASE_SHIELD = 3;             // Knight +1
const BASE_HEAL = 3;               // Priest +1
const BASE_POI = 1;                // Assassin +1

const mods = {
  Knight:{ maxHP:35, diamondCap:+0, lucky:+0, shield:+1, heal:+0, poi:+0 },
  Mage:{   maxHP:30, diamondCap:+1, lucky:+1, shield:+0, heal:+0, poi:+0 },
  Assassin:{maxHP:30,diamondCap:+0, lucky:+0, shield:+0, heal:+0, poi:+1 },
  Priest:{ maxHP:35, diamondCap:+0, lucky:+0, shield:+0, heal:+1, poi:+0 },
};

/* -------- State -------- */
let S = {
  perf:false,
  boss:{ id:'jack', name:'Jacks', hp:8, maxHP:8, atk:2, round:1, poison:0, jackPlus2:false, jokerTimes2:false },
  A:{ cls:'Knight', hp:35, maxHP:35, plays:1, playsMax:1, diamond:0, shield:0 },
  B:{ cls:'Mage',   hp:30, maxHP:30, plays:1, playsMax:1, diamond:0, shield:0 },
};

const $=id=>document.getElementById(id);

/* -------- Helpers -------- */
const clamp=(v,lo,hi)=>Math.max(lo,Math.min(hi,v));
const d12=()=>Math.floor(Math.random()*12)+1;
const capPlays=h=>BASE_DIAMOND_CAP+(mods[h.cls]?.diamondCap||0);
const lucky=h=>1+(mods[h.cls]?.lucky||0);
const shieldVal=h=>BASE_SHIELD+(mods[h.cls]?.shield||0);
const healVal=h=>BASE_HEAL+(mods[h.cls]?.heal||0);
const poiVal=h=>BASE_POI+(mods[h.cls]?.poi||0);
function hero(which){return which==='A'?S.A:S.B}

/* -------- Save/Load (lean) -------- */
function save(){
  const { ...lean } = S;
  try{ localStorage.setItem('rc.simple.two', JSON.stringify(lean)); }catch{}
}
function load(){
  const raw = localStorage.getItem('rc.simple.two');
  if(!raw) return;
  try{
    const loaded = JSON.parse(raw);
    S = {...S, ...loaded};
    // enforce current plays policy on load
    ['A','B'].forEach(k=>{
      S[k].plays = BASE_PLAYS_PER_HERO;
      S[k].playsMax = BASE_PLAYS_PER_HERO;
      S[k].diamond = 0;
    });
  }catch{}
}

/* -------- Render -------- */
function render(){
  $('bossName').textContent = S.boss.name;
  $('bossStats').textContent = `HP ${S.boss.hp}/${S.boss.maxHP} • DMG ${S.boss.atk}`;
  $('hpNow').textContent = S.boss.hp;
  $('hpMax').textContent = S.boss.maxHP;
  $('hpBar').style.width = Math.max(0,Math.min(100,(S.boss.hp/S.boss.maxHP)*100))+'%';
  $('poiVal').textContent = S.boss.poison;
  $('roundOut').textContent = 'R'+S.boss.round;

  // A
  $('hpA').textContent = S.A.hp;
  updateStatusChip('A');
  // B
  $('hpB').textContent = S.B.hp;
  updateStatusChip('B');

  save();
}
function updateStatusChip(which){
  const h = hero(which);
  const el = $('status'+which);
  const parts=[];
  if(h.shield>0) parts.push(`Shield ${h.shield}`);
  if(h.playsMax>BASE_PLAYS_PER_HERO) parts.push(`Plays ${h.plays}/${h.playsMax}`);
  el.textContent = parts.join(' • ');
  el.classList.toggle('hide', parts.length===0);
}

/* -------- Boss control -------- */
function pickBoss(id){
  const b = bosses.find(x=>x.id===id);
  S.boss = { id:b.id, name:b.name, hp:b.maxHP, maxHP:b.maxHP, atk:b.atk, round:1, poison:0, jackPlus2:false, jokerTimes2:false };
  // new round baseline for heroes
  ['A','B'].forEach(k=>{
    S[k].plays = BASE_PLAYS_PER_HERO;
    S[k].playsMax = BASE_PLAYS_PER_HERO;
    S[k].diamond = 0;
    S[k].shield = 0;
  });
  render();
}
function bossAbility(){
  const r = d12();
  let msg = `d12: ${r} • DMG ${S.boss.atk}`;
  if(S.boss.id==='jack'){
    S.boss.jackPlus2 = (r<=3);
    msg = S.boss.jackPlus2 ? `d12: ${r} • DMG ${S.boss.atk+2} (base ${S.boss.atk}+2)` : `d12: ${r} • DMG ${S.boss.atk}`;
  }else if(S.boss.id==='queen'){
    if(r<=3){ S.boss.hp = clamp(S.boss.hp+3,0,S.boss.maxHP); msg = `d12: ${r} • Heal +3 • DMG ${S.boss.atk}`; }
  }else if(S.boss.id==='king'){
    if(r<=2){ S.boss.poison=0; msg = `d12: ${r} • Purge POI • DMG ${S.boss.atk}`; }
  }else if(S.boss.id==='joker'){
    S.boss.jokerTimes2 = (r>=8 && r<=10);
    msg = S.boss.jokerTimes2 ? `d12: ${r} • DMG ${S.boss.atk*2} (×2)` : `d12: ${r} • DMG ${S.boss.atk}`;
  }
  $('abilityOut').textContent = msg;
  render();
}
function bossTurn(){
  // POI tick
  if(S.boss.poison>0){ S.boss.hp = clamp(S.boss.hp - S.boss.poison, 0, S.boss.maxHP); }
  // damage calc
  let dmg = S.boss.atk;
  if(S.boss.id==='jack' && S.boss.jackPlus2) dmg+=2;
  if(S.boss.id==='joker' && S.boss.jokerTimes2) dmg*=2;
  // target
  const tgt = $('bossTarget').value;
  const h = (tgt==='AUTO') ? ((S.A.hp<=S.B.hp)?S.A:S.B) : (tgt==='A'?S.A:S.B);
  const reduced = Math.max(0, dmg - h.shield);
  h.shield = 0;
  h.hp = clamp(h.hp - reduced, 0, h.maxHP);
  // next round
  S.boss.round += 1;
  S.boss.jackPlus2 = false; S.boss.jokerTimes2 = false;
  ['A','B'].forEach(k=>{ S[k].plays=BASE_PLAYS_PER_HERO; S[k].playsMax=BASE_PLAYS_PER_HERO; S[k].diamond=0; });
  $('abilityOut').textContent = `Boss dealt ${reduced} to ${h===S.A?'A':'B'}`;
  render();
}

/* -------- Hero actions -------- */
function classApply(which, cls){
  const h = hero(which);
  const pct = h.hp / h.maxHP;
  h.cls = cls;
  h.maxHP = mods[cls]?.maxHP || 30;
  h.hp = clamp(Math.round(h.maxHP*pct||h.maxHP),0,h.maxHP);
  render();
}
function spendPlay(h){
  if(h.plays<=0) return false;
  h.plays -= 1;
  render();
  return true;
}
function grantDiamond(h){
  const cap = capPlays(h);
  if(h.playsMax >= BASE_PLAYS_PER_HERO + cap) return; // already at cap
  h.plays += 1;
  h.playsMax += 1;
  h.diamond += 1;
  render();
}
function hit(which){
  const h = hero(which);
  const val = Number($(which==='A'?'valA':'valB').value);
  const suit = (which==='A'?$('suitA').value:$('suitB').value);
  const outR = $(which==='A'?'rollOutA':'rollOutB');
  const outT = $(which==='A'?'resultA':'resultB');

  if(h.plays<=0){ outT.textContent = 'No actions'; return; }

  const r = d12();
  outR.textContent = `d12: ${r}`;

  if(r===12){ spendPlay(h); h.hp = clamp(h.hp-1,0,h.maxHP); outT.textContent='Fumble (self-1)'; render(); return; }
  if(r>val){  spendPlay(h); outT.textContent='Miss'; render(); return; }

  // Hit!
  if(!spendPlay(h)) return;
  let dmg = DMG_PER_HIT;
  if(r===1) dmg += lucky(h);
  S.boss.hp = clamp(S.boss.hp - dmg, 0, S.boss.maxHP);

  let tag = `Hit −${dmg}`;

  if(suit==='club'){ h.shield += shieldVal(h); tag += ` • ♣ Shield +${shieldVal(h)}`; }
  else if(suit==='heart'){ h.hp = clamp(h.hp + healVal(h), 0, h.maxHP); tag += ` • ♥ Heal +${healVal(h)}`; }
  else if(suit==='spade'){ S.boss.poison += poiVal(h); $('poiVal').textContent = S.boss.poison; tag += ` • ♠ POI +${poiVal(h)}`; }
  else if(suit==='diamond'){ grantDiamond(h); tag += ` • ♦ +1 play`; }

  outT.textContent = tag;
  render();
}

/* -------- UI wire -------- */
function initBossButtons(){
  const c = $('bossButtons');
  bosses.forEach(b=>{
    const btn = document.createElement('button');
    btn.className='btn';
    btn.textContent = b.label;
    btn.addEventListener('click', ()=>pickBoss(b.id));
    c.appendChild(btn);
  });
}
function init(){
  load();
  if(!S.boss || !S.boss.maxHP){ pickBoss('jack'); }
  // Boss
  $('abilityBtn').addEventListener('click', bossAbility);
  $('bossTurnBtn').addEventListener('click', bossTurn);
  $('poiPlus').addEventListener('click', ()=>{ S.boss.poison+=1; render(); });
  $('poiMinus').addEventListener('click', ()=>{ S.boss.poison=Math.max(0,S.boss.poison-1); render(); });
  $('resetBoss').addEventListener('click', ()=>pickBoss(S.boss.id));
  // Heroes
  $('classA').addEventListener('change', e=>classApply('A', e.target.value));
  $('classB').addEventListener('change', e=>classApply('B', e.target.value));
  $('hpAMinus').addEventListener('click', ()=>{ S.A.hp=clamp(S.A.hp-1,0,S.A.maxHP); render(); });
  $('hpAPlus').addEventListener('click',  ()=>{ S.A.hp=clamp(S.A.hp+1,0,S.A.maxHP); render(); });
  $('hpBMinus').addEventListener('click', ()=>{ S.B.hp=clamp(S.B.hp-1,0,S.B.maxHP); render(); });
  $('hpBPlus').addEventListener('click',  ()=>{ S.B.hp=clamp(S.B.hp+1,0,S.B.maxHP); render(); });
  $('rollA').addEventListener('click', ()=>hit('A'));
  $('rollB').addEventListener('click', ()=>hit('B'));
  // Footer
  $('perfModeChk').addEventListener('change', e=>{ S.perf=!!e.target.checked; document.documentElement.classList.toggle('perf', S.perf); save(); });
  $('clearSaveBtn').addEventListener('click', ()=>{ try{localStorage.removeItem('rc.simple.two')}catch{} location.reload(); });

  initBossButtons();
  render();
}
init();
</script>
</body>
</html>
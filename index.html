<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Royal Crush — Two-Hero Tracker (Fast)</title>
<style>
  :root{
    --bg:#0f1115; --panel:#171a21; --muted:#202534; --ink:#e9eef6; --sub:#aab3c2;
    --accent:#6ee7b7; --accent-2:#60a5fa; --warn:#f59e0b; --danger:#ef4444;
    --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);
    font:15px/1.5 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  h1{margin:0 0 12px;font-size:20px}
  .card{
    background:linear-gradient(180deg,var(--panel),#121722);
    border:1px solid #272c3b; border-radius:14px; padding:14px; box-shadow:var(--shadow)
  }
  .grid{display:grid; gap:10px}
  .g2{grid-template-columns:1fr 1fr}
  .g3{grid-template-columns:repeat(3,1fr)}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .pill{background:#141a24;border:1px solid #293143;border-radius:999px;padding:6px 10px;color:#cfe3ff;font-size:12px}
  .sub{color:var(--sub);font-size:12px}
  .bar{height:14px;background:#0e1420;border:1px solid #283045;border-radius:999px;overflow:hidden}
  .bar>span{display:block;height:100%;background:linear-gradient(90deg,#60a5fa,#34d399)}
  input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #2b3040;background:#0f131b;color:#e9eef6}
  .btn{padding:10px 12px;border-radius:12px;border:1px solid #2b3040;background:#151924;color:#e9eef6;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .btn.ghost{background:transparent}
  .btn.red{background:#2a1215;border-color:#3a1a1e;color:#ffdada}
  .btn.yellow{background:#2e2613;border-color:#463a16;color:#fff1c2}
  .btn.blue{background:#14243b;border-color:#1e3554;color:#d9ecff}
  .hint{font-size:12px;color:#95a3ba}
  .section-title{font-size:13px;color:#b8c5da;margin:6px 0}
  .boss-btn{flex:1 1 160px;padding:10px;border-radius:12px;border:1px solid #2b3040;background:#171b25;color:#e9eef6;text-align:left}
  .boss-btn.active{outline:2px solid var(--accent-2);background:#132033}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,"Liberation Mono","Courier New",monospace}
  .perf .card{background:#151923; box-shadow:none}
  .perf .bar>span{background:#60a5fa}
  .heroCard{display:flex;flex-direction:column;gap:6px}
  .heroHead{display:flex;justify-content:space-between;align-items:center}
  .footer-controls{margin-top:14px; display:flex; gap:10px; align-items:center; justify-content:flex-start}
</style>
</head>
<body>
<div class="wrap">
  <h1>Royal Crush — Two-Hero Tracker</h1>

  <div class="card" style="margin-bottom:10px">
    <!-- Boss header -->
    <div class="row" style="justify-content:space-between">
      <div>
        <div class="sub">Current Royal</div>
        <div style="font-size:22px;font-weight:700" id="bossName">—</div>
        <div class="sub" id="bossStatsSub">HP — • DMG —</div>
      </div>
      <div style="text-align:right">
        <div class="sub">Boss HP</div>
        <div style="font-size:26px;font-weight:700"><span id="hpNow">0</span>/<span id="hpMax">0</span></div>
      </div>
    </div>
    <div class="bar" style="margin:10px 0 12px"><span id="hpBar" style="width:0%"></span></div>

    <!-- Boss tools -->
    <div class="grid g3">
      <div class="card" style="padding:10px">
        <div class="section-title">Boss Ability</div>
        <div class="row">
          <button class="btn yellow" id="abilityBtn">Roll Ability (d12)</button>
          <div class="pill mono" id="abilityOut">—</div>
        </div>
        <div class="section-title" style="margin-top:8px">Targeting</div>
        <div class="row">
          <select id="bossTarget">
            <option value="A">Target Hero A</option>
            <option value="B">Target Hero B</option>
            <option value="AUTO" selected>Auto (lowest HP)</option>
          </select>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn red" id="bossTurnBtn">Boss Turn ➜ Next Round</button>
          <div class="pill mono" id="roundOut">Round 1</div>
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn blue" id="poiPlus">POI +1</button>
          <button class="btn" id="poiMinus">POI -1</button>
          <div class="pill">POI: <span id="poiVal">0</span></div>
        </div>
        <div class="hint" style="margin-top:6px">
          Boss Turn: POI ticks, ability applied, damage goes to selected hero (reduced by that hero’s Shield).
        </div>
      </div>

      <div class="card" style="padding:10px">
        <div class="section-title">Quick Boss HP Adjust</div>
        <div class="row">
          <button class="btn red" data-delta="-5">Hit (−5)</button>
          <button class="btn red" data-delta="-6">Lucky 1 (−6)</button>
          <button class="btn" data-delta="+1">+1 HP</button>
          <button class="btn" data-delta="+3">+3 HP</button>
        </div>
        <div class="row" style="margin-top:6px">
          <button class="btn ghost" id="resetBoss">Reset This Boss</button>
        </div>
      </div>

      <div class="card" style="padding:10px">
        <div class="section-title">Change Boss</div>
        <div class="row" id="bossButtons"></div>
        <div class="hint" style="margin-top:6px">Jacks 8/2 (≤3 +2) • Queens 12/4 (≤3 heal3) • Kings 16/5 (≤2 purge) • Joker 24/6 (8–10 ×2)</div>
      </div>
    </div>
  </div>

  <!-- Heroes -->
  <div class="grid g2">
    <!-- Hero A -->
    <div class="card heroCard" id="heroA">
      <div class="heroHead">
        <div>
          <div class="section-title">Hero A</div>
          <div class="row">
            <select id="classA">
              <option>Knight</option>
              <option>Mage</option>
              <option>Assassin</option>
              <option>Priest</option>
            </select>
            <div class="pill">HP: <span id="hpA">35</span></div>
            <button class="btn" id="hpAMinus">-1</button>
            <button class="btn" id="hpAPlus">+1</button>
          </div>
          <div class="row" style="margin-top:6px">
            <div class="pill">Plays: <span id="playsA">2</span> / <span id="playsMaxA">2</span></div>
            <div class="pill">Shield: <span id="shieldA">0</span></div>
          </div>
        </div>
        <div class="pill">Acting: <label><input type="radio" name="actor" value="A" checked/> A</label></div>
      </div>

      <div class="section-title">Hit Check (A)</div>
      <div class="row">
        <select id="valA">
          <option>2</option><option>3</option><option>4</option>
          <option selected>5</option><option>6</option><option>7</option>
          <option>8</option><option>9</option>
        </select>
        <select id="suitA">
          <option value="club">♣</option>
          <option value="spade">♠</option>
          <option value="heart">♥</option>
          <option value="diamond" selected>♦</option>
        </select>
        <button class="btn yellow" id="rollA">Roll d12</button>
      </div>
      <div class="row" style="margin-top:6px">
        <div class="pill mono" id="rollOutA">—</div>
        <div class="pill mono" id="resultA">—</div>
      </div>
    </div>

    <!-- Hero B -->
    <div class="card heroCard" id="heroB">
      <div class="heroHead">
        <div>
          <div class="section-title">Hero B</div>
          <div class="row">
            <select id="classB">
              <option>Knight</option>
              <option selected>Mage</option>
              <option>Assassin</option>
              <option>Priest</option>
            </select>
            <div class="pill">HP: <span id="hpB">30</span></div>
            <button class="btn" id="hpBMinus">-1</button>
            <button class="btn" id="hpBPlus">+1</button>
          </div>
          <div class="row" style="margin-top:6px">
            <div class="pill">Plays: <span id="playsB">2</span> / <span id="playsMaxB">2</span></div>
            <div class="pill">Shield: <span id="shieldB">0</span></div>
          </div>
        </div>
        <div class="pill">Acting: <label><input type="radio" name="actor" value="B"/> B</label></div>
      </div>

      <div class="section-title">Hit Check (B)</div>
      <div class="row">
        <select id="valB">
          <option>2</option><option>3</option><option>4</option>
          <option selected>5</option><option>6</option><option>7</option>
          <option>8</option><option>9</option>
        </select>
        <select id="suitB">
          <option value="club">♣</option>
          <option value="spade">♠</option>
          <option value="heart">♥</option>
          <option value="diamond" selected>♦</option>
        </select>
        <button class="btn yellow" id="rollB">Roll d12</button>
      </div>
      <div class="row" style="margin-top:6px">
        <div class="pill mono" id="rollOutB">—</div>
        <div class="pill mono" id="resultB">—</div>
      </div>
    </div>
  </div>

  <!-- Footer controls moved here -->
  <div class="footer-controls">
    <label class="row" style="gap:6px">
      <input type="checkbox" id="perfModeChk" />
      <span class="sub">Performance Mode (reduce effects & haptics)</span>
    </label>
    <button class="btn ghost" id="clearSaveBtn">Clear Save</button>
  </div>

  <p class="hint" style="margin-top:8px">State auto-saves locally. Two heroes act with their own plays, shields, and class perks.</p>
</div>

<script>
/* ------------ Constants (boss & system) ------------ */
const bosses = [
  {id:'jack',  label:'J♣ J♠ J♥ J♦', name:'Jacks',  maxHP:8,  atk:2},
  {id:'queen', label:'Q♣ Q♠ Q♥ Q♦', name:'Queens', maxHP:12, atk:4},
  {id:'king',  label:'K♣ K♠ K♥ K♦', name:'Kings',  maxHP:16, atk:5},
  {id:'joker', label:'Joker Joker',  name:'Jokers', maxHP:24, atk:6},
];
const DMG_PER_HIT = 5;
const LUCKY_EXTRA = 1; // global +1, Mage adds +1 more
const BASE_PLAYS_PER_HERO = 2;
const BASE_DIAMOND_CAP = 2;
const BASE_SHIELD = 3;
const BASE_HEAL = 3;
const BASE_POI = 1;

/* ------------ Class modifiers ------------ */
const classMods = {
  Knight:   { maxHP:35, diamondCap:+0, luckyExtra:+0, shieldBonus:+1, healBonus:+0, poiBonus:+0 },
  Mage:     { maxHP:30, diamondCap:+1, luckyExtra:+1, shieldBonus:+0, healBonus:+0, poiBonus:+0 },
  Assassin: { maxHP:30, diamondCap:+0, luckyExtra:+0, shieldBonus:+0, healBonus:+0, poiBonus:+1 },
  Priest:   { maxHP:35, diamondCap:+0, luckyExtra:+0, shieldBonus:+0, healBonus:+1, poiBonus:+0 },
};

/* ------------ State ------------ */
let state = {
  perfMode:false,

  boss:{ id:'jack', name:'Jacks', hp:8, maxHP:8, atk:2, round:1, poison:0, jackPlus2:false, jokerTimes2:false },

  A:{ cls:'Knight', hp:35, maxHP:35, plays:2, playsMax:2, diamondEarned:0, shield:0 },
  B:{ cls:'Mage',   hp:30, maxHP:30, plays:2, playsMax:2, diamondEarned:0, shield:0 },

  history:[]
};

/* ------------ Elements ------------ */
const $ = id => document.getElementById(id);
const els = {
  root: document.documentElement,

  // footer controls (moved)
  perfChk: $('perfModeChk'),
  clearSave: $('clearSaveBtn'),

  bossName: $('bossName'),
  bossStatsSub: $('bossStatsSub'),
  hpNow: $('hpNow'), hpMax: $('hpMax'), hpBar: $('hpBar'),
  roundOut: $('roundOut'), abilityOut: $('abilityOut'),

  bossButtons: $('bossButtons'),
  bossTurnBtn: $('bossTurnBtn'),
  abilityBtn: $('abilityBtn'),
  bossTarget: $('bossTarget'),
  poiPlus: $('poiPlus'), poiMinus: $('poiMinus'), poiVal: $('poiVal'),
  resetBoss: $('resetBoss'),

  // Hero A
  classA: $('classA'), hpA: $('hpA'), hpAMinus: $('hpAMinus'), hpAPlus: $('hpAPlus'),
  playsA: $('playsA'), playsMaxA: $('playsMaxA'), shieldA: $('shieldA'),
  valA: $('valA'), suitA: $('suitA'), rollA: $('rollA'), rollOutA: $('rollOutA'), resultA: $('resultA'),

  // Hero B
  classB: $('classB'), hpB: $('hpB'), hpBMinus: $('hpBMinus'), hpBPlus: $('hpBPlus'),
  playsB: $('playsB'), playsMaxB: $('playsMaxB'), shieldB: $('shieldB'),
  valB: $('valB'), suitB: $('suitB'), rollB: $('rollB'), rollOutB: $('rollOutB'), resultB: $('resultB'),

  bossButtonsContainer: $('bossButtons')
};

/* ------------ Perf-safe utils ------------ */
let saveTimer=null, rafDirty=false;
function scheduleSave(){
  if(saveTimer) return;
  saveTimer = setTimeout(()=>{ saveTimer=null;
    const {history, ...lean} = state;
    try{ localStorage.setItem('rc.two.fast', JSON.stringify(lean)); }catch{}
  }, 300);
}
function load(){
  const raw = localStorage.getItem('rc.two.fast');
  if(!raw) return;
  try{
    const loaded = JSON.parse(raw);
    state = {...state, ...loaded, history:[]};
  }catch{}
}
function scheduleRender(){ if(rafDirty) return; rafDirty=true; requestAnimationFrame(render); }
function vibrate(ms=10){ if(state.perfMode) return; try{ if(navigator.vibrate) navigator.vibrate(ms);}catch{} }

/* ------------ Helpers ------------ */
function clamp(v,lo,hi){ return Math.max(lo, Math.min(hi, v)); }
function pushHistory(){
  const snap = JSON.parse(JSON.stringify(state));
  snap.history = []; // no nesting
  state.history.push(snap);
  if(state.history.length>5) state.history.shift();
}
function undo(){
  const last = state.history.pop();
  if(!last) return;
  state = last;
  scheduleRender();
}

function heroRef(which){ return which==='A' ? state.A : state.B; }
function applyBossHP(d){ state.boss.hp = clamp(state.boss.hp + d, 0, state.boss.maxHP); }
function applyHeroHP(h, d){ h.hp = clamp(h.hp + d, 0, h.maxHP); }

function computeLuckyBonus(h){
  const base = 1 + (classMods[h.cls]?.luckyExtra || 0);
  return base; // nat-1 adds this much
}
function computeDiamondCap(h){ return BASE_DIAMOND_CAP + (classMods[h.cls]?.diamondCap || 0); }
function shieldValue(h){ return BASE_SHIELD + (classMods[h.cls]?.shieldBonus || 0); }
function healValue(h){ return BASE_HEAL + (classMods[h.cls]?.healBonus || 0); }
function poiValue(h){ return BASE_POI + (classMods[h.cls]?.poiBonus || 0); }

/* ------------ Boss switching/reset ------------ */
function pickBoss(id){
  const b = bosses.find(x=>x.id===id);
  pushHistory();
  state.boss = { id:b.id, name:b.name, hp:b.maxHP, maxHP:b.maxHP, atk:b.atk, round:1, poison:0, jackPlus2:false, jokerTimes2:false };
  // reset round for heroes (keep HP)
  ['A','B'].forEach(w=>{
    const h = heroRef(w);
    h.plays = BASE_PLAYS_PER_HERO;
    h.playsMax = BASE_PLAYS_PER_HERO;
    h.diamondEarned = 0;
    h.shield = 0;
  });
  scheduleRender();
}
function resetBoss(){ pickBoss(state.boss.id); }

/* ------------ Boss ability + turn ------------ */
function rollD12(){ return Math.floor(Math.random()*12)+1; }

function bossAbility(){
  const r = rollD12();
  let msg = `d12: ${r} • DMG ${state.boss.atk}`;
  if(state.boss.id === 'jack'){
    state.boss.jackPlus2 = (r <= 3);
    msg = state.boss.jackPlus2 ? `d12: ${r} • DMG ${state.boss.atk+2} (base ${state.boss.atk} +2)` : `d12: ${r} • DMG ${state.boss.atk}`;
  } else if(state.boss.id === 'queen'){
    if(r <= 3){
      state.boss.hp = clamp(state.boss.hp + 3, 0, state.boss.maxHP);
      msg = `d12: ${r} • Heal +3 • DMG ${state.boss.atk}`;
    }
  } else if(state.boss.id === 'king'){
    if(r <= 2){
      state.boss.poison = 0;
      msg = `d12: ${r} • Purge POI • DMG ${state.boss.atk}`;
    }
  } else if(state.boss.id === 'joker'){
    state.boss.jokerTimes2 = (r >= 8 && r <= 10);
    msg = state.boss.jokerTimes2 ? `d12: ${r} • DMG ${state.boss.atk*2} (×2)` : `d12: ${r} • DMG ${state.boss.atk}`;
  }
  document.getElementById('abilityOut').textContent = msg;
  scheduleRender();
}

function bossTurn(){
  pushHistory();

  // 1) POI tick on boss
  if(state.boss.poison > 0){
    state.boss.hp = clamp(state.boss.hp - state.boss.poison, 0, state.boss.maxHP);
  }

  // 2) Compute DMG with ability flags
  let dmg = state.boss.atk;
  if(state.boss.id==='jack' && state.boss.jackPlus2) dmg += 2;
  if(state.boss.id==='joker' && state.boss.jokerTimes2) dmg *= 2;

  // 3) Choose target
  let target = document.getElementById('bossTarget').value;
  let h = null;
  if(target==='AUTO'){
    h = (state.A.hp <= state.B.hp) ? state.A : state.B; // lowest HP
  } else {
    h = (target==='A') ? state.A : state.B;
  }

  // 4) Apply shield of target only
  const reduced = Math.max(0, dmg - h.shield);
  h.shield = 0;
  h.hp = clamp(h.hp - reduced, 0, h.maxHP);

  // 5) Clear flags and advance round; reset plays for both heroes
  state.boss.jackPlus2 = false;
  state.boss.jokerTimes2 = false;
  state.boss.round += 1;

  ['A','B'].forEach(w=>{
    const he = heroRef(w);
    he.plays = BASE_PLAYS_PER_HERO;
    he.playsMax = BASE_PLAYS_PER_HERO;
    he.diamondEarned = 0;
  });

  document.getElementById('abilityOut').textContent = `Boss dealt ${reduced} to ${h===state.A?'Hero A':'Hero B'}`;
  scheduleRender();
}

/* ------------ Hero actions (roll to hit) ------------ */
function spendPlay(h){
  if(h.plays<=0) return false;
  h.plays -= 1;
  scheduleRender();
  return true;
}
function grantDiamond(h){
  const cap = computeDiamondCap(h);
  if(h.diamondEarned >= cap) return;
  h.diamondEarned += 1;
  h.plays += 1;
  h.playsMax += 1;
  scheduleRender();
}

function doHeroRoll(which){
  const h = heroRef(which);
  const val = Number((which==='A'?els.valA.value:els.valB.value));
  const suit = (which==='A'?els.suitA.value:els.suitB.value);
  const outRoll = (which==='A'?els.rollOutA:els.rollOutB);
  const outRes  = (which==='A'?els.resultA:els.resultB);

  if(h.plays<=0){ outRes.textContent='No plays left'; return; }

  const r = rollD12();
  outRoll.textContent = `d12: ${r}`;

  // Fumble
  if(r===12){
    spendPlay(h);
    applyHeroHP(h, -1);
    outRes.textContent = 'FUMBLE: self-1';
    return;
  }
  // Miss
  if(r > val){
    spendPlay(h);
    outRes.textContent = 'Miss';
    return;
  }

  // Hit!
  if(!spendPlay(h)) return;
  let dmg = DMG_PER_HIT;
  if(r===1) dmg += computeLuckyBonus(h); // +1 (Mage +2 total)

  applyBossHP(-dmg);

  // Suit effects
  if(suit==='club'){ h.shield += shieldValue(h); outRes.textContent = `Hit −${dmg} • ♣ Shield +${shieldValue(h)}`; }
  else if(suit==='heart'){ applyHeroHP(h, +healValue(h)); outRes.textContent = `Hit −${dmg} • ♥ Heal +${healValue(h)}`; }
  else if(suit==='spade'){ state.boss.poison += poiValue(h); document.getElementById('poiVal').textContent = state.boss.poison; outRes.textContent = `Hit −${dmg} • ♠ POI +${poiValue(h)}`; }
  else if(suit==='diamond'){ grantDiamond(h); outRes.textContent = `Hit −${dmg} • ♦ +1 play (cap ${computeDiamondCap(h)})`; }

  scheduleRender();
}

/* ------------ Boss picker & quick hp ------------ */
function initBossPicker(){
  const frag = document.createDocumentFragment();
  bosses.forEach(b=>{
    const el = document.createElement('button');
    el.className = 'boss-btn';
    el.dataset.id = b.id;
    el.innerHTML = `<strong>${b.label}</strong><div class="sub">HP ${b.maxHP} • DMG ${b.atk}</div>`;
    el.addEventListener('click', ()=> pickBoss(b.id), {passive:true});
    frag.appendChild(el);
  });
  els.bossButtonsContainer.appendChild(frag);
}
function initQuickButtons(){
  document.querySelectorAll('[data-delta]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const d = Number(btn.getAttribute('data-delta'));
      pushHistory();
      applyBossHP(d);
      scheduleRender();
    }, {passive:true});
  });
}

/* ------------ Class changes ------------ */
function applyClass(which, cls){
  const h = heroRef(which);
  h.cls = cls;
  const prevMax = h.maxHP || classMods[h.cls]?.maxHP || 30;
  const pct = h.maxHP ? (h.hp / h.maxHP) : 1;
  const nextMax = classMods[cls]?.maxHP || 30;
  h.maxHP = nextMax;
  h.hp = clamp(Math.round(nextMax * pct), 0, nextMax);
  scheduleRender();
}

/* ------------ Render ------------ */
function render(){
  rafDirty=false;

  // Perf class
  document.documentElement.classList.toggle('perf', !!state.perfMode);

  // Boss
  document.getElementById('bossName').textContent = state.boss.name;
  document.getElementById('bossStatsSub').textContent = `HP ${state.boss.hp}/${state.boss.maxHP} • DMG ${state.boss.atk}`;
  document.getElementById('hpNow').textContent = state.boss.hp;
  document.getElementById('hpMax').textContent = state.boss.maxHP;
  document.getElementById('hpBar').style.width = Math.max(0, Math.min(100, (state.boss.hp/state.boss.maxHP)*100)) + '%';
  document.getElementById('poiVal').textContent = state.boss.poison;
  document.getElementById('roundOut').textContent = `Round ${state.boss.round}`;

  // Hero A
  document.getElementById('hpA').textContent = state.A.hp;
  document.getElementById('playsA').textContent = state.A.plays;
  document.getElementById('playsMaxA').textContent = state.A.playsMax;
  document.getElementById('shieldA').textContent = state.A.shield;

  // Hero B
  document.getElementById('hpB').textContent = state.B.hp;
  document.getElementById('playsB').textContent = state.B.plays;
  document.getElementById('playsMaxB').textContent = state.B.playsMax;
  document.getElementById('shieldB').textContent = state.B.shield;

  scheduleSave();
}

/* ------------ Init ------------ */
function init(){
  load();
  // Default boss if first time
  if(!state.boss || !state.boss.maxHP){ pickBoss('jack'); }

  initBossPicker();
  initQuickButtons();

  // Footer controls (now at bottom)
  els.perfChk.checked = !!state.perfMode;
  els.perfChk.addEventListener('change', e=>{ state.perfMode = !!e.target.checked; scheduleRender(); });
  els.clearSave.addEventListener('click', ()=>{ try{ localStorage.removeItem('rc.two.fast'); }catch{} pickBoss(state.boss.id); });

  // Boss controls
  document.getElementById('abilityBtn').addEventListener('click', bossAbility);
  document.getElementById('bossTurnBtn').addEventListener('click', bossTurn);
  document.getElementById('poiPlus').addEventListener('click', ()=>{ pushHistory(); state.boss.poison += 1; scheduleRender(); }, {passive:true});
  document.getElementById('poiMinus').addEventListener('click', ()=>{ pushHistory(); state.boss.poison = Math.max(0, state.boss.poison-1); scheduleRender(); }, {passive:true});
  document.getElementById('resetBoss').addEventListener('click', resetBoss);

  // Hero A events
  document.getElementById('classA').addEventListener('change', e=> applyClass('A', e.target.value));
  document.getElementById('hpAMinus').addEventListener('click', ()=>{ pushHistory(); applyHeroHP(state.A, -1); scheduleRender(); });
  document.getElementById('hpAPlus').addEventListener('click',  ()=>{ pushHistory(); applyHeroHP(state.A, +1); scheduleRender(); });
  document.getElementById('rollA').addEventListener('click',   ()=> doHeroRoll('A'));

  // Hero B events
  document.getElementById('classB').addEventListener('change', e=> applyClass('B', e.target.value));
  document.getElementById('hpBMinus').addEventListener('click', ()=>{ pushHistory(); applyHeroHP(state.B, -1); scheduleRender(); });
  document.getElementById('hpBPlus').addEventListener('click',  ()=>{ pushHistory(); applyHeroHP(state.B, +1); scheduleRender(); });
  document.getElementById('rollB').addEventListener('click',    ()=> doHeroRoll('B'));

  // Initial class application to set maxHP correctly
  applyClass('A', state.A.cls);
  applyClass('B', state.B.cls);

  scheduleRender();
}
init();
</script>
</body>
</html>